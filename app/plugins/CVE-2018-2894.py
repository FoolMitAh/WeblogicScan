#!/usr/bin/env python
# _*_ coding:utf-8 _*_

import requests
from ..platform import ManageProcessor, Color

VUL = ['CVE-2018-2894']
headers = {'user-agent': 'ceshi/0.0.1'}


@ManageProcessor.plugin_register('CVE-2018-2894')
class CVE20182894(object):
    def process(self, ip, port):
        return self.run(ip, port, 0)

    def islive(self, ur, port):
        url = 'http://' + str(ur) + ':' + str(port) + '/ws_utc/resources/setting/options/general'
        r = requests.get(url, headers=headers)
        return r.status_code

    def run(self, ip, port, index):
        if self.islive(ip, port) != 404:
            print(Color.OKBLUE + '[+]The target weblogic has a JAVA deserialization vulnerability: {}'.format(VUL[index]) + Color.ENDC)
            return True
        else:
            print(Color.FAIL + '[-]Target weblogic not detected {}'.format(VUL[index]) + Color.ENDC)
            return False
